# .github/workflows/your-workflow-name.yml

name: Trigger Market Indicators Update

on:
  schedule:
    # 한국 시간 기준, 오전 6시부터 오후 8시까지 2시간 간격으로 실행
    # KST 06:00 (UTC 21:00 전날), 08:00(23), 10:00(01), 12:00(03), 14:00(05), 16:00(07), 18:00(09), 20:00(11)
    - cron: '0 21,23,1,3,5,7,9,11 * * *'
  
  workflow_dispatch: # 수동 실행 허용

jobs:
  trigger-api:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Market Indicators API
        env:
          VERCEL_DEPLOYMENT_URL: ${{ secrets.VERCEL_DEPLOYMENT_URL }}
        run: |
          if [ -z "$VERCEL_DEPLOYMENT_URL" ]; then
            echo "::error::VERCEL_DEPLOYMENT_URL secret is not set."
            exit 1
          fi

          echo "Triggering market indicators update..."
          
          # API 엔드포인트에 간단한 POST 요청을 보내 크롤링을 트리거합니다.
          # 불필요한 데이터(-d)와 헤더(-H)를 제거하여 명령어를 간소화했습니다.
          curl --fail -X POST "${VERCEL_DEPLOYMENT_URL}/api/market-indicators"
          
          echo "API trigger completed."