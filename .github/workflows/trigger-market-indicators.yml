name: Trigger Market Indicators Update

on:
  schedule:
    # 한국 시간 기준, 오전 6시부터 오후 8시까지 2시간 간격으로 실행
    - cron: '0 21,23,1,3,5,7,9,11 * * *'
  
  workflow_dispatch: # 수동 실행 허용

jobs:
  trigger-api:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Market Indicators API
        env:
          VERCEL_DEPLOYMENT_URL: ${{ secrets.VERCEL_DEPLOYMENT_URL }}
        run: |
          if [ -z "$VERCEL_DEPLOYMENT_URL" ]; then
            echo "::error::VERCEL_DEPLOYMENT_URL secret is not set."
            exit 1
          fi

          echo "Triggering market indicators update..."
          echo "Target URL: ${VERCEL_DEPLOYMENT_URL}/api/market-indicators" # 디버깅을 위해 URL 출력
          
          # API 응답 본문(JSON)을 버려서 쉘 오류 방지
          curl --fail -L -X POST "${VERCEL_DEPLOYMENT_URL}/api/market-indicators" > /dev/null
          
          echo "API trigger completed."